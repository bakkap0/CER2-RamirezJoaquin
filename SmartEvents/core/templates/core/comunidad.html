{% extends 'core/base.html' %}
{% load static %}

{% block title %}Comunidad - SmartEvents{% endblock %}

{% block content %}
<div class="container-fluid d-flex justify-content-center align-items-center min-vh-100" id="comunidad-bg" style="background-image: url('{% static 'core/imagenes/fondo.png' %}'); background-size: cover; background-position: center;">
    <div id="com" class="my-4 bg-dark text-light p-4 rounded" style="width: 90%; max-width: 600px;">

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}

        {% if user.is_authenticated %}
            <section id="formulario-comentario" class="mb-4 p-3 rounded" style="background-color: #1d2633;">
                <h2 class="text-center mb-3">Deja tu Comentario</h2>
                <form method="post" action="{% url 'comunidad' %}">
                    {% csrf_token %}

                    {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                    {% endif %}


                    <div class="mb-3" id="textoBox">
                        <label for="{{ form.texto.id_for_label }}" class="form-label">{{ form.texto.label }}</label>
                        {{ form.texto }}
                        {% if form.texto.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.texto.errors %}<p>{{ error }}</p>{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="text-center">
                        <button id="publicarBtn" type="submit" class="btn btn-primary mt-2">Publicar</button>
                    </div>
                </form>
            </section>
        {% else %}
            <div class="alert alert-info text-center">
                Debes <a href="{% url 'login' %}?next={{ request.path }}">iniciar sesión</a> para poder publicar comentarios.
            </div>
        {% endif %}


        <div id="listaComentarios">
            <h4 class="mb-3">Comentarios publicados</h4>
            <ul class="list-group" id="comentariosUl">
                {% for comentario in comentarios %}
                    <li class="list-group-item mb-2 bg-light text-dark">
                        <div class="d-flex justify-content-between align-items-baseline mb-1">
                            <strong>
                                {{ comentario.usuario.username }}
                            </strong>
                            <small class="text-muted">{{ comentario.fecha_creacion|date:"d M Y, H:i" }}</small>
                        </div>
                        <div>{{ comentario.texto|linebreaksbr }}</div>
                    </li>
                {% empty %}
                    <li class="list-group-item">Aún no hay comentarios. ¡Sé el primero en publicar!</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}